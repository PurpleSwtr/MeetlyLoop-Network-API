## 📘 Руководство: Добавление Зависимостей в Docker-проект

### 🎯 Главный Принцип

Ваш проект существует в двух параллельных вселенных:

1.  **Ваша Локальная Машина:** Здесь вы пишете код. Ваша IDE (VS Code, PyCharm) и локальные инструменты (Node.js, Python venv) должны "знать" о новой библиотеке, чтобы давать вам подсказки и автодополнение.
2.  **Docker-образ:** Это изолированная, "замороженная" версия вашего приложения. Она ничего не знает о вашей локальной машине. Чтобы библиотека появилась *внутри* контейнера, вы должны пересобрать этот образ с новыми инструкциями.

Процесс всегда состоит из **двух обязательных шагов**:

1.  **Шаг 1: Обновить "Рецепт"** — изменить файл, который описывает зависимости (`requirements.txt` или `package.json`).
2.  **Шаг 2: Пересобрать Образ** — дать Docker команду `docker compose up --build`, чтобы он создал новый образ по обновленному "рецепту".

---

### Сценарий 1: Добавление Frontend-зависимости (на примере `axios`)

**Задача:** Добавить библиотеку `axios` для выполнения HTTP-запросов в React-приложении.

**Шаг 1: Обновляем "Рецепт" Фронтенда**

1.  **Остановите все контейнеры**, если они запущены:
    ```bash
    docker compose down
    ```

2.  **Перейдите в папку фронтенда:**
    ```bash
    cd frontend
    ```

3.  **Установите пакет с помощью `npm`:**
    ```bash
    npm install axios
    ```
    *   **Что происходит в этот момент:**
        *   `axios` скачивается и добавляется в вашу локальную папку `node_modules`.
        *   **Самое важное:** `npm` автоматически обновляет два файла-рецепта: `package.json` (добавляет `axios` в секцию `dependencies`) и `package-lock.json` (закрепляет точную версию).

4.  **Вернитесь в корневую папку проекта:**
    ```bash
    cd ..
    ```

**Шаг 2: Пересборка Docker-образа Фронтенда**

Теперь, когда "рецепт" (`package.json`) обновлен, нужно заставить Docker пересобрать образ `frontend` по этому новому рецепту.

1.  **Выполните команду сборки и запуска:**
    ```bash
    docker compose up --build
    ```
    *   **Что делает флаг `--build`:** Он приказывает Docker не использовать старый, кэшированный образ для `frontend`, а заново выполнить все шаги из `frontend/Dockerfile`.
    *   Когда Docker дойдет до шага `RUN npm install`, он увидит обновленный `package.json` и установит `axios` уже **внутри** образа.

✅ **Готово!** Теперь `axios` доступен и для вашей локальной разработки (благодаря `npm install`), и внутри Docker-контейнера (благодаря `--build`). Вы можете спокойно использовать `import axios from 'axios';` в своем React-коде.

---

### Сценарий 2: Добавление Backend-зависимости (на примере `httpx`)

**Задача:** Добавить библиотеку `httpx` для выполнения асинхронных HTTP-запросов в FastAPI.

**Шаг 1: Обновляем "Рецепт" Бэкенда**

1.  **Остановите все контейнеры**, если они запущены:
    ```bash
    docker compose down
    ```

2.  **Активируйте ваше локальное виртуальное окружение:**
    *   *Это нужно, чтобы ваша IDE знала о новой библиотеке.*
    ```bash
    # Для Windows (Git Bash)
    source venv/Scripts/activate
    # Для macOS/Linux
    # source venv/bin/activate 
    ```

3.  **Установите пакет с помощью `pip`:**
    ```bash
    pip install httpx
    ```

4.  **"Заморозьте" зависимости в `requirements.txt`:**
    *   *В отличие от npm, pip не обновляет файл-рецепт автоматически. Это нужно делать вручную.*
    ```bash
    pip freeze > backend/requirements.txt
    ```
    *   **Что происходит:** Команда `pip freeze` смотрит на всё, что установлено в вашем `venv`, и записывает этот список в файл `backend/requirements.txt`. Теперь там появится строка `httpx==...`.

5.  **(Опционально) Деактивируйте виртуальное окружение:**
    ```bash
    deactivate
    ```

**Шаг 2: Пересборка Docker-образа Бэкенда**

Процесс точно такой же, как и для фронтенда.

1.  **Выполните команду сборки и запуска из корневой папки проекта:**
    ```bash
    docker compose up --build
    ```
    *   **Что делает флаг `--build`:** Он заставит Docker пересобрать образ `backend`. Когда Docker дойдет до шага `RUN pip install -r /code/requirements.txt` в `backend/Dockerfile`, он прочитает обновленный файл и установит `httpx` внутри образа.

✅ **Готово!** Библиотека `httpx` теперь доступна и в вашем локальном `venv`, и внутри Docker-контейнера. Можете использовать `import httpx` в коде FastAPI.

---

### สรุป Золотое правило

| Часть проекта | 1. Обновить "рецепт"                                    | 2. Пересобрать образ               |
| :------------ | :------------------------------------------------------- | :--------------------------------- |
| **Frontend**  | `cd frontend` -> `npm install <package_name>` -> `cd ..` | `docker compose up --build`        |
| **Backend**   | `pip install <package_name>` -> `pip freeze > backend/requirements.txt` | `docker compose up --build` |