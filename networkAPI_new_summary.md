
---

### üìÑ `alembic.txt`

```text
alembic revision --autogenerate -m "new"

alembic upgrade/downgrade 9d49044c23d7

–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –±–∞–∑–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ (–ü–ï–†–í–û–ô)
alembic downgrade base

alembic upgrade head

alembic revision --autogenerate -m "add_DateTime_in_posts"

```

---

### üìÑ `requirements.txt`

```text
# requirements.txt
fastapi
uvicorn[standard]
sqlalchemy
asyncpg
psycopg2-binary
pydantic-settings
python-dotenv

httpx
async-lru
```

---

### üìÑ `run.txt`

```text
uvicorn src.main:app --reload --host 127.0.0.1 --port 8000
```

---

### üìÑ `venv.txt`

```text
python -m venv venv

source venv/Scripts/activate

```

---

### üìÑ `.vscode\settings.json`

```json
{
    "python.analysis.autoImportCompletions": false
}
```

---

### üìÑ `alembic\env.py`

```python
import sys
import os

sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), '..', 'src')))

from logging.config import fileConfig

from sqlalchemy import engine_from_config
from sqlalchemy import pool

from alembic import context

from src.core.config import settings
from models.posts.model import PostsORM
from models.users.model import UsersORM
from src.core.database import Base

config = context.config

if config.config_file_name is not None:
    fileConfig(config.config_file_name)


config.set_main_option("sqlalchemy.url", settings.DATABASE_URL_ASYNC + "?async_fallback=True")

target_metadata = Base.metadata




def run_migrations_offline() -> None:
    """Run migrations in 'offline' mode.

    This configures the context with just a URL
    and not an Engine, though an Engine is acceptable
    here as well.  By skipping the Engine creation
    we don't even need a DBAPI to be available.

    Calls to context.execute() here emit the given string to the
    script output.

    """
    url = config.get_main_option("sqlalchemy.url")
    context.configure(
        url=url,
        target_metadata=target_metadata,
        literal_binds=True,
        dialect_opts={"paramstyle": "named"},
    )

    with context.begin_transaction():
        context.run_migrations()


def run_migrations_online() -> None:
    """Run migrations in 'online' mode.

    In this scenario we need to create an Engine
    and associate a connection with the context.

    """
    connectable = engine_from_config(
        config.get_section(config.config_ini_section, {}),
        prefix="sqlalchemy.",
        poolclass=pool.NullPool,
    )

    with connectable.connect() as connection:
        context.configure(
            connection=connection, 
            target_metadata=target_metadata,
            compare_server_default=True
        )

        with context.begin_transaction():
            context.run_migrations()


if context.is_offline_mode():
    run_migrations_offline()
else:
    run_migrations_online()

```

---

### üìÑ `alembic\versions\a354dcab0cd2_add_datetime_in_posts.py`

```python
"""add_DateTime_in_posts

Revision ID: a354dcab0cd2
Revises:
Create Date: 2025-08-10 00:28:39.991914

"""

from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = "a354dcab0cd2"
down_revision: Union[str, Sequence[str], None] = None
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column(
        "posts", sa.Column("created_at", sa.DateTime(), nullable=True)
    )
    op.add_column(
        "posts", sa.Column("updated_at", sa.DateTime(), nullable=True)
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_column("posts", "updated_at")
    op.drop_column("posts", "created_at")
    # ### end Alembic commands ###

```

---

### üìÑ `alembic\versions\e38de6c3621a_add_theme_in_posts.py`

```python
"""add_theme_in_posts

Revision ID: e38de6c3621a
Revises: a354dcab0cd2
Create Date: 2025-08-10 01:59:00.057848

"""

from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = "e38de6c3621a"
down_revision: Union[str, Sequence[str], None] = "a354dcab0cd2"
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column("posts", sa.Column("theme", sa.String(), nullable=True))
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_column("posts", "theme")
    # ### end Alembic commands ###

```

---

### üìÑ `frontend\index.html`

```html
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Network</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

    <header class="app-header">
        <div class="container">
            <nav class="main-nav">
                <a href="#/" class="logo">MyNetwork</a>
                <ul>
                    <li><a href="#/">–õ–µ–Ω—Ç–∞</a></li>
                    <li><a href="#/create-post">–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç</a></li>
                    <li><a href="#/users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main id="app-root" class="container">
        <!-- –°—é–¥–∞ JavaScript –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü -->
    </main>
    
    <!-- –°–∫—Ä–∏–ø—Ç –ø–æ–¥–∫–ª—é—á–∞–µ–º –≤ –∫–æ–Ω—Ü–µ body -->
    <script src="/static/script.js"></script>
</body>
</html>
```

---

### üìÑ `frontend\static\script.js`

```javascript
const API_BASE_URL = 'http://127.0.0.1:8000';
const appRoot = document.getElementById('app-root');

// --- 1. –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ü–û–õ–£–ß–ï–ù–ò–Ø –î–ê–ù–ù–´–• –° API ---

async function getPosts() {
    try {
        const response = await fetch(`${API_BASE_URL}/get_posts`);
        if (!response.ok) throw new Error('Network response was not ok');
        return await response.json();
    } catch (error) {
        console.error('Failed to fetch posts:', error);
        return []; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
    }
}

async function getUsers() {
    try {
        const response = await fetch(`${API_BASE_URL}/get_users`);
        if (!response.ok) throw new Error('Network response was not ok');
        return await response.json();
    } catch (error) {
        console.error('Failed to fetch users:', error);
        return [];
    }
}


// --- 2. –§–£–ù–ö–¶–ò–ò-–®–ê–ë–õ–û–ù–´ –î–õ–Ø –û–¢–†–ò–°–û–í–ö–ò –°–¢–†–ê–ù–ò–¶ ---

// –®–∞–±–ª–æ–Ω –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø–æ—Å—Ç–∞ –≤ –ª–µ–Ω—Ç–µ
function createPostCard(post) {
    const postDate = new Date(post.created_at).toLocaleString('ru-RU');
    const authorInitial = post.author.nickname.charAt(0) || '?';

    return `
        <div class="post-card">
            <div class="post-card-header">
                <div class="avatar">${authorInitial}</div>
                <div class="author-info">
                    <p class="nickname">${post.author.nickname}</p>
                    <p class="post-date">${postDate}</p>
                </div>
            </div>
            <div class="post-card-body">
                <h2>${post.title}</h2>
                <p>${post.description}</p>
                ${post.theme ? `<span class="theme">#${post.theme}</span>` : ''}
            </div>
        </div>
    `;
}

// –†–µ–Ω–¥–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã "–õ–µ–Ω—Ç–∞"
async function renderFeedPage() {
    appRoot.innerHTML = '<h2>–ó–∞–≥—Ä—É–∑–∫–∞ –ª–µ–Ω—Ç—ã...</h2>';
    const posts = await getPosts();
    if (posts.length === 0) {
        appRoot.innerHTML = '<h2>–õ–µ–Ω—Ç–∞ –ø—É—Å—Ç–∞. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –ø–æ—Å—Ç!</h2>';
        return;
    }
    const feedHtml = posts.map(createPostCard).join('');
    appRoot.innerHTML = `<h1>–õ–µ–Ω—Ç–∞</h1>${feedHtml}`;
}

// –†–µ–Ω–¥–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã "–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç"
async function renderCreatePostPage() {
    const users = await getUsers();
    const userOptions = users.map(user => `<option value="${user.id}">${user.nickname}</option>`).join('');

    appRoot.innerHTML = `
        <div class="form-container">
            <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–æ—Å—Ç</h2>
            <form id="create-post-form">
                <select name="user_id" required>
                    <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤—Ç–æ—Ä–∞</option>
                    ${userOptions}
                </select>
                <input type="text" name="title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫" required>
                <textarea name="description" placeholder="–ß—Ç–æ —É –≤–∞—Å –Ω–æ–≤–æ–≥–æ?" rows="5" required></textarea>
                <input type="text" name="theme" placeholder="–¢–µ–º–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, '–Ω–æ–≤–æ—Å—Ç–∏')">
                <button type="submit">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
            </form>
        </div>
    `;

    // –ù–∞–≤–µ—à–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ –Ω–æ–≤—É—é —Ñ–æ—Ä–º—É
    document.getElementById('create-post-form').addEventListener('submit', handleCreatePost);
}

// –†–µ–Ω–¥–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"
async function renderUsersPage() {
    appRoot.innerHTML = '<h2>–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</h2>';
    const users = await getUsers();
    const usersHtml = users.map(user => `
        <div class="post-card" style="margin-bottom: 1rem;">
            <div class="post-card-header">
                 <div class="avatar">${user.nickname.charAt(0)}</div>
                 <p class="nickname" style="font-size: 1.2rem;">${user.nickname}</p>
            </div>
        </div>
    `).join('');
    appRoot.innerHTML = `<h1>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h1>${usersHtml}`;
}

// --- 3. –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ---

async function handleCreatePost(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const params = new URLSearchParams();
    
    // –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º formData –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    for (const [key, value] of formData.entries()) {
        params.append(key, value);
    }
    
    try {
        const response = await fetch(`${API_BASE_URL}/create_post?${params.toString()}`, {
            method: 'POST',
        });
        if (!response.ok) throw new Error('Failed to create post');
        
        // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É (–ª–µ–Ω—Ç—É) –ø–æ—Å–ª–µ —É—Å–ø–µ—Ö–∞
        window.location.hash = '#/';

    } catch (error) {
        console.error(error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ—Å—Ç–∞');
    }
}


// --- 4. –†–û–£–¢–ï–† ---

const routes = {
    '/': renderFeedPage,
    '/create-post': renderCreatePostPage,
    '/users': renderUsersPage,
};

function router() {
    // –ü–æ–ª—É—á–∞–µ–º —Ö—ç—à –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º '/' –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    const path = window.location.hash.slice(1) || '/';
    const renderFunction = routes[path];

    if (renderFunction) {
        renderFunction();
    } else {
        appRoot.innerHTML = '<h2>–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</h2>';
    }
}

// –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ö—ç—à–∞ –∏ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
window.addEventListener('hashchange', router);
window.addEventListener('load', () => {
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ö—ç—à –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
    if (!window.location.hash) {
        window.location.hash = '#/';
    }
    router();
});
```

---

### üìÑ `frontend\static\style.css`

```css
:root {
    --primary-color: #0d6efd;
    --background-color: #f0f2f5;
    --card-bg-color: #ffffff;
    --text-color: #212529;
    --text-secondary: #6c757d;
    --border-color: #dee2e6;
    --shadow: 0 4px 12px rgba(0,0,0,0.08);
    --border-radius: 8px;
}

body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    margin: 0;
    background-color: var(--background-color);
    color: var(--text-color);
}

.container {
    max-width: 800px;
    margin: 0 auto;
    padding: 1rem;
}

/* --- –®–∞–ø–∫–∞ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è --- */
.app-header {
    background-color: var(--card-bg-color);
    border-bottom: 1px solid var(--border-color);
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.main-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 60px;
}

.main-nav .logo {
    font-size: 1.5rem;
    font-weight: bold;
    color: var(--primary-color);
    text-decoration: none;
}

.main-nav ul {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    gap: 1.5rem;
}

.main-nav a {
    text-decoration: none;
    color: var(--text-secondary);
    font-weight: 500;
    transition: color 0.2s;
}

.main-nav a:hover, .main-nav a.active {
    color: var(--primary-color);
}

/* --- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç --- */
#app-root {
    padding-top: 2rem;
}

/* --- –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ—Å—Ç–∞ (–õ–µ–Ω—Ç–∞) --- */
.post-card {
    background: var(--card-bg-color);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    margin-bottom: 1.5rem;
    box-shadow: var(--shadow);
    overflow: hidden;
}

.post-card-header {
    display: flex;
    align-items: center;
    padding: 1rem 1.5rem;
    gap: 1rem;
}

.avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: var(--primary-color);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.2rem;
    text-transform: uppercase;
}

.author-info .nickname {
    font-weight: 600;
    margin: 0;
}
.author-info .post-date {
    font-size: 0.85rem;
    color: var(--text-secondary);
    margin: 0;
}

.post-card-body {
    padding: 0 1.5rem 1.5rem;
}
.post-card-body h2 {
    margin: 0 0 0.5rem;
    font-size: 1.5rem;
}
.post-card-body p {
    margin: 0;
    line-height: 1.6;
}
.post-card-body .theme {
    margin-top: 1rem;
    font-size: 0.9rem;
    color: var(--primary-color);
    background-color: #e7f3ff;
    padding: 0.2rem 0.6rem;
    border-radius: 1rem;
    display: inline-block;
}

/* --- –§–æ—Ä–º—ã --- */
.form-container {
    background: var(--card-bg-color);
    padding: 2rem;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
}
.form-container h2 {
    margin-top: 0;
}
form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}
input, select, textarea, button {
    padding: 0.8rem;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    font-size: 1rem;
    font-family: inherit;
}
button {
    background-color: var(--primary-color);
    color: white;
    border: none;
    cursor: pointer;
    font-weight: 500;
    transition: background-color 0.2s;
}
button:hover {
    background-color: #0b5ed7;
}
```

---

### üìÑ `src\main.py`

```python
# # app/main.py

# import asyncio
# from typing import Annotated

# from fastapi import FastAPI, Depends
# from fastapi.middleware.cors import CORSMiddleware

# from sqlalchemy import select, insert

# from src.core.database import sync_engine, async_engine, sync_session_factory, get_async_session

# from src.models.users.model import UsersORM
# from src.models.posts.model import PostsORM


# from src.api import main_router

# app = FastAPI(
#     title="My Network API",


# )

# app.add_middleware(
#     CORSMiddleware,
#     allow_origins=["*"],  # <-- –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
#     allow_credentials=True,
#     allow_methods=["*"],
#     allow_headers=["*"],
# )

# app.include_router(main_router)

# @app.get("/",
#         tags=["üíª Root"],
#         summary="–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—á–∫–∞")
# def read_root():
#     return {"message": "API is running. Welcome!"}

# src/main.py

import asyncio
from typing import Annotated

from fastapi import FastAPI, Depends
from fastapi.middleware.cors import CORSMiddleware
from fastapi.staticfiles import StaticFiles
from fastapi.responses import HTMLResponse

from sqlalchemy import select, insert

from src.core.database import sync_engine, async_engine, sync_session_factory, get_async_session

from src.models.users.model import UsersORM
from src.models.posts.model import PostsORM

from src.api import main_router

app = FastAPI(
    title="My Network API",
)

# --- –î–û–ë–ê–í–õ–ï–ù–ê –†–ê–ó–î–ê–ß–ê –°–¢–ê–¢–ò–ß–ï–°–ö–ò–• –§–ê–ô–õ–û–í ---
# –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –±—Ä–∞—É–∑–µ—Ä—É –ø–æ–ª—É—á–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ –≤–∞—à–∏–º css –∏ js —Ñ–∞–π–ª–∞–º
# –ü—É—Ç—å "/static" –±—É–¥–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –ø–∞–ø–∫–µ "frontend/static"
app.mount("/static", StaticFiles(directory="frontend/static"), name="static")
# --- –ö–û–ù–ï–¶ –î–û–ë–ê–í–õ–ï–ù–ò–Ø ---


app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

app.include_router(main_router)

@app.get("/",
        tags=["üíª Frontend"],
        summary="–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (Frontend)",
        response_class=HTMLResponse)
def read_root():
    try:
        with open("frontend/index.html", "r", encoding="utf-8") as f:
            return HTMLResponse(content=f.read())
    except FileNotFoundError:
        return HTMLResponse(content="<h1>Frontend file not found. Please create frontend/index.html</h1>", status_code=404)
```

---

### üìÑ `src\api\dependencies.py`

```python
from typing import Annotated
from fastapi import Depends
from sqlalchemy.ext.asyncio import AsyncSession
from src.core.database import get_async_session


SessionDep = Annotated[AsyncSession, Depends(get_async_session)]

```

---

### üìÑ `src\api\__init__.py`

```python
# __init__.py
from fastapi import APIRouter 
from src.models.users.router import router as users_router
from src.models.posts.router import router as posts_router


main_router = APIRouter()

main_router.include_router(users_router)
main_router.include_router(posts_router)


```

---

### üìÑ `src\core\config.py`

```python
# core/config.py
from pydantic_settings import BaseSettings, SettingsConfigDict
class Settings(BaseSettings):
    DB_HOST: str
    DB_PORT: int
    DB_USER: str
    DB_PASS: str
    DB_NAME: str
    
    
    @property
    def DATABASE_URL_ASYNC(self) -> str:
        return f"postgresql+asyncpg://{self.DB_USER}:{self.DB_PASS}@{self.DB_HOST}:{self.DB_PORT}/{self.DB_NAME}"

    @property
    def DATABASE_URL_SYNC(self) -> str:
        return f"postgresql+psycopg2://{self.DB_USER}:{self.DB_PASS}@{self.DB_HOST}:{self.DB_PORT}/{self.DB_NAME}"



    model_config = SettingsConfigDict(env_file=".env")

settings = Settings()
```

---

### üìÑ `src\core\database.py`

```python
# import asyncio
# from sqlalchemy.ext.asyncio import create_async_engine, async_sessionmaker, AsyncSession
# from sqlalchemy.orm import sessionmaker, Session
# from sqlalchemy import URL, create_engine, text
# from sqlalchemy.exc import SQLAlchemyError
# from .config import settings
# from users.models import metadata_obj

from typing import AsyncGenerator

from sqlalchemy import create_engine
from sqlalchemy.ext.asyncio import create_async_engine, async_sessionmaker, AsyncSession

from sqlalchemy.orm import Session, sessionmaker, DeclarativeBase


from .config import settings

class Base(DeclarativeBase):
    pass

sync_engine = create_engine(
    url=settings.DATABASE_URL_SYNC,
    echo=True,
)

async_engine = create_async_engine(
    url=settings.DATABASE_URL_ASYNC,
    echo=True,
)

sync_session_factory = sessionmaker(sync_engine)
async_session_factory = async_sessionmaker(async_engine, expire_on_commit=False)

# async def test():
#     async with engine.connect() as conn:
#         res = await conn.execute(text("SELECT 1"))
#         print(f"res: {res.all()=}")

# –§—É–Ω–∫—Ü–∏—è-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö FastAPI
async def get_async_session() -> AsyncGenerator[AsyncSession, None]:
    async with async_session_factory() as session:
        yield session

```

---

### üìÑ `src\core\__init__.py`

```python
# __init__.py

```

---

### üìÑ `src\models\posts\model.py`

```python
# src/models/posts/models.py

from typing import TYPE_CHECKING
from sqlalchemy import ForeignKey, String, text, DateTime
from sqlalchemy.orm import Mapped, mapped_column, relationship

from src.core.database import Base

if TYPE_CHECKING:
    from models.users.model import UsersORM


class PostsORM(Base):
    __tablename__ = "posts" 

    id: Mapped[int] = mapped_column(primary_key=True)
    
    user_id: Mapped[int] = mapped_column(ForeignKey("users.id"))
    author: Mapped["UsersORM"] = relationship(back_populates="posts")
    
    title: Mapped[str] = mapped_column(String)
    description: Mapped[str] = mapped_column(String)
    theme: Mapped[str] = mapped_column(String, nullable=True)


    created_at: Mapped[str] = mapped_column(DateTime, nullable=True)
    updated_at: Mapped[str] = mapped_column(DateTime, nullable=True)

```

---

### üìÑ `src\models\posts\router.py`

```python
# from fastapi import APIRouter
# from sqlalchemy import select, insert

# from src.api.dependencies import SessionDep
# from src.models.posts.model import PostsORM

# router = APIRouter()

# @router.get("/get_posts",
#             tags=["üìù –ü–æ—Å—Ç—ã"],
#             summary="–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ—Å—Ç–æ–≤")
# async def get_posts(session: SessionDep):
#     query = select(PostsORM)
#     result = await session.execute(query)
#     posts = result.scalars().all()
#     return posts

# @router.post("/create_post",
#             tags=["üìù –ü–æ—Å—Ç—ã"],
#             summary="–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç")
# async def create_new_post(session: SessionDep, user_id: int, title: str, description: str, theme: str): 
#     stmt = insert(PostsORM).values(
#         user_id=user_id,
#         title=title,
#         description=description,
#         theme=theme
#     )
#     await session.execute(stmt)
#     await session.commit()
#     return {"status": "success", "title": title}

from fastapi import APIRouter
from sqlalchemy import select, insert
# --- –î–û–ë–ê–í–õ–ï–ù–ù–´–ï –ò–ú–ü–û–†–¢–´ ---
from sqlalchemy.orm import selectinload
from typing import List
from .schemas import PostRead
# --- –ö–û–ù–ï–¶ –î–û–ë–ê–í–õ–ï–ù–ò–ô ---

from src.api.dependencies import SessionDep
from src.models.posts.model import PostsORM

router = APIRouter()

# --- –ò–ó–ú–ï–ù–ï–ù–ù–´–ô –≠–ù–î–ü–û–ò–ù–¢ ---
@router.get("/get_posts",
            tags=["üìù –ü–æ—Å—Ç—ã"],
            summary="–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ—Å—Ç–æ–≤ —Å –∞–≤—Ç–æ—Ä–∞–º–∏",
            response_model=List[PostRead]) # <-- –£–∫–∞–∑—ã–≤–∞–µ–º —Å—Ö–µ–º—É –æ—Ç–≤–µ—Ç–∞
async def get_posts(session: SessionDep):
    # .options(selectinload(PostsORM.author)) - "–∂–∞–¥–Ω–æ" –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ—Ä–æ–≤
    # .order_by(...) - —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç –ø–æ—Å—Ç—ã, —á—Ç–æ–±—ã –Ω–æ–≤—ã–µ –±—ã–ª–∏ —Å–≤–µ—Ä—Ö—É
    query = (
        select(PostsORM)
        .options(selectinload(PostsORM.author))
        .order_by(PostsORM.created_at.desc())
    )
    result = await session.execute(query)
    posts = result.scalars().all()
    return posts
# --- –ö–û–ù–ï–¶ –ò–ó–ú–ï–ù–ï–ù–ò–ô ---

@router.post("/create_post",
            tags=["üìù –ü–æ—Å—Ç—ã"],
            summary="–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç")
async def create_new_post(session: SessionDep, user_id: int, title: str, description: str, theme: str | None = None):
    # –î–æ–±–∞–≤–ª—è–µ–º created_at –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
    from datetime import datetime
    stmt = insert(PostsORM).values(
        user_id=user_id,
        title=title,
        description=description,
        theme=theme,
        created_at=datetime.utcnow() # <-- –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
    )
    await session.execute(stmt)
    await session.commit()
    return {"status": "success", "title": title}
```

---

### üìÑ `src\models\posts\schemas.py`

```python
# src/models/posts/schemas.py
from pydantic import BaseModel, ConfigDict
from datetime import datetime

# –°—Ö–µ–º–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–Ω—É—Ç—Ä–∏ –ø–æ—Å—Ç–∞
# –û—Ç–¥–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ, –±–µ–∑ –ø–∞—Ä–æ–ª—è –∏ —Ç.–¥.
class UserRead(BaseModel):
    id: int
    nickname: str

# –°—Ö–µ–º–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ—Å—Ç–∞
class PostRead(BaseModel):
    id: int
    title: str
    description: str
    theme: str | None
    created_at: datetime | None
    
    # –í–ª–æ–∂–µ–Ω–Ω–∞—è —Å—Ö–µ–º–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∞
    author: UserRead

    model_config = ConfigDict(from_attributes=True)


```

---

### üìÑ `src\models\posts\__init__.py`

```python
# __init__.py

```

---

### üìÑ `src\models\users\model.py`

```python
# src/models/users/models.py

from typing import TYPE_CHECKING
from sqlalchemy import DateTime, String
from sqlalchemy.orm import Mapped, mapped_column, relationship

from src.core.database import Base

if TYPE_CHECKING:
    from models.posts.model import PostsORM


class UsersORM(Base):
    __tablename__ = "users" 

    id: Mapped[int] = mapped_column(primary_key=True)
    nickname: Mapped[str] = mapped_column(String) 
    email: Mapped[str] = mapped_column(String, nullable=True)
    password_hash: Mapped[str] = mapped_column(String, nullable=True)
    description: Mapped[str] = mapped_column(String, nullable=True)
    profile_photo_url: Mapped[str] = mapped_column(String, nullable=True)
    created_at: Mapped[str] = mapped_column(DateTime, nullable=True)
    updated_at: Mapped[str] = mapped_column(DateTime, nullable=True)
    

    # --- –î–û–ë–ê–í–õ–ï–ù–ù–ê–Ø –°–í–Ø–ó–¨ ---
    # –°–æ–∑–¥–∞–µ–º relationship, –∫–æ—Ç–æ—Ä–∞—è "—Å–æ–±–µ—Ä–µ—Ç" –≤—Å–µ –ø–æ—Å—Ç—ã —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    # back_populates="author" —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∞—Ç—Ä–∏–±—É—Ç 'author' –≤ –º–æ–¥–µ–ª–∏ PostsORM
    posts: Mapped[list["PostsORM"]] = relationship(back_populates="author")
```

---

### üìÑ `src\models\users\router.py`

```python
# src/models/users/router.py

from fastapi import APIRouter
from sqlalchemy import select, insert

from src.api.dependencies import SessionDep
from src.models.users.model import UsersORM

router = APIRouter()

@router.get("/get_users",
            tags=["üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"],
            summary="–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π")
async def get_users(session: SessionDep):
    query = select(UsersORM)
    result = await session.execute(query)
    users = result.scalars().all()
    return users

@router.post("/create_user",
            tags=["üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"],
            summary="–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
async def create_new_user(session: SessionDep, nickname:str, email:str, password_hash:str, description:str):
    stmt = insert(UsersORM).values(nickname=nickname, email=email, password_hash=password_hash, description=description)
    await session.execute(stmt)
    await session.commit()
    return {"status": "success", "nickname": nickname}


```

---

### üìÑ `src\models\users\__init__.py`

```python
# __init__.py

```
