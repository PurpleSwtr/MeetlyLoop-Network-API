# Alembic - Шпаргалка по командам

## 1. Создание новой миграции (автоматически)

Эта команда сравнивает ваши модели SQLAlchemy с текущим состоянием БД и генерирует файл миграции с необходимыми изменениями.

```bash
alembic revision --autogenerate -m "Понятное описание изменений"
```

*   **`--autogenerate`**: Включает автоматическое определение изменений.
*   **`-m "..."`**: Задаёт осмысленное описание. **Не используйте** "new" или "update". Хороший пример: `"add_user_email_column"`.
*   **Важно:** Всегда проверяйте сгенерированный файл миграции вручную.

## 2. Применение всех миграций (обновление до последней версии)

Обновляет схему БД до самой последней версии (`head`), выполняя все новые, ещё не применённые миграции.

```bash
alembic upgrade head
```

*   Это основная команда для развёртывания приложения или обновления локальной БД после `git pull`.

## 3. Откат всех миграций (возврат к началу)

Откатывает все применённые миграции, возвращая БД в состояние до применения самой первой миграции (`base`).

```bash
alembic downgrade base
```

*   **Внимание!** Эта операция удаляет таблицы/колонки и приводит к потере данных. Используйте в основном для разработки.

## 4. Переход к конкретной версии

Используется для обновления или отката до определённой ревизии по её ID.

### Обновление ДО указанной версии

Применяет миграции до версии `9d49044c23d7` включительно.

```bash
alembic upgrade 9d49044c23d7
```

### Откат С указанной версии

Откатывает **одну** миграцию `9d49044c23d7`, возвращая БД к состоянию *перед* ней.

```bash
alembic downgrade 9d49044c23d7
```

### Откат на одну версию назад

Более удобный способ откатить последнюю примененную миграцию.

```bash
alembic downgrade -1
```